generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ChatSession {
  id        String    @id @default(uuid())
  title     String    @default("새로운 채팅")
  model     String    @default("GPT-OSS-120B")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  messages  Message[]
}

model Message {
  id               String      @id @default(uuid())
  streamId         String
  role             String      // "user" | "assistant"
  content          String      @db.Text
  reasoningContent String?     @db.Text
  images           Json?       // ImageAttachment[]
  orderIndex       Int
  createdAt        DateTime    @default(now())

  session          ChatSession @relation(fields: [streamId], references: [id], onDelete: Cascade)

  @@index([streamId])
  @@index([streamId, orderIndex])
}
